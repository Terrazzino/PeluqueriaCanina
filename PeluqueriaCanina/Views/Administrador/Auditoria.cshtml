@model List<PeluqueriaCanina.Models.Auditoria>

@{
    ViewData["Title"] = "Auditoría";
    var query = ViewContext.HttpContext.Request.Query;

    var rolFiltro = query.ContainsKey("rol") ? query["rol"].ToString() : "";
    var accionFiltro = query.ContainsKey("accion") ? query["accion"].ToString() : "";
    var fechaDesde = query.ContainsKey("fechaDesde") ? query["fechaDesde"].ToString() : "";
    var fechaHasta = query.ContainsKey("fechaHasta") ? query["fechaHasta"].ToString() : "";

    var roles = new[] { "", "Cliente", "Peluquero", "Administrador" };
    var acciones = Model.Select(a => a.Accion).Distinct().OrderBy(a => a).ToList();
}

<h2>Registro de Auditoría</h2>

<form method="get" class="mb-3 row g-2">
    <div class="col-md-3">
        <label>Rol:</label>
        <select name="rol" class="form-control">
            @foreach (var r in roles)
            {
                var texto = string.IsNullOrEmpty(r) ? "-- Todos --" : r;
                if (r == rolFiltro)
                {
                    <option value="@r" selected="selected">@texto</option>
                }
                else
                {
                    <option value="@r">@texto</option>
                }
            }
        </select>
    </div>

    <div class="col-md-3">
        <label>Acción:</label>
        <select name="accion" class="form-control">
            <option value="">-- Todas --</option>
            @foreach (var a in acciones)
            {
                if (a == accionFiltro)
                {
                    <option value="@a" selected="selected">@a</option>
                }
                else
                {
                    <option value="@a">@a</option>
                }
            }
        </select>
    </div>

    <div class="col-md-2">
        <label>Desde:</label>
        <input type="date" name="fechaDesde" class="form-control" value="@fechaDesde" />
    </div>

    <div class="col-md-2">
        <label>Hasta:</label>
        <input type="date" name="fechaHasta" class="form-control" value="@fechaHasta" />
    </div>

    <div class="col-md-2 d-flex align-items-end">
        <button type="submit" class="btn btn-primary w-100">Filtrar</button>
    </div>
</form>

<table class="table table-striped table-bordered text-white">
    <thead>
        <tr>
            <th>Fecha/Hora</th>
            <th>Usuario</th>
            <th>Rol</th>
            <th>Acción</th>
            <th>Detalles</th>
        </tr>
    </thead>

    <tbody>
        @foreach (var a in Model)
        {
            <tr>
                <td>@a.FechaHora.ToString("g")</td>
                <td>@a.NombreUsuario</td>
                <td>@a.RolUsuario</td>
                <td>@a.Accion</td>
                <td>@a.Detalles</td>
            </tr>
        }
    </tbody>
</table>
