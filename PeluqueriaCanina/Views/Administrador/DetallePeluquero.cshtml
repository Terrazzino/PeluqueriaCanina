@{
    ViewData["Title"] = "Detalle de " + ViewBag.Peluquero;
}

<div class="overlay-dark p-4">
    <div class="container d-flex justify-content-center">

        <!-- Card principal -->
        <div class="card card-custom text-light shadow-lg rounded-4 p-4 w-100" style="max-width: 800px;">

            <!-- Encabezado -->
            <div class="d-flex justify-content-between align-items-center flex-wrap mb-4">
                <div class="text-center w-100">
                    <h2 class="text-light fw-bold mb-1">Reporte de @ViewBag.Peluquero</h2>
                    <p class="text-secondary mb-0">Servicio: @ViewBag.Servicio</p>
                </div>
            </div>

            <!-- Gráfico -->
            <div class="table-responsive mt-3">
                <canvas id="graficoTurnos" style="max-height: 400px; width: 100%;"></canvas>
            </div>

            <!-- Resumen -->
            <div class="mt-4 text-center">
                @{
                    var recaudado = ViewBag.Recaudado as decimal? ?? 0m;
                    string claseColor =
                    recaudado < 40000 ? "text-danger" :
                    recaudado < 50000 ? "text-warning" :
                    "text-success";
                }
                <h5>Total Recaudado: <span class="@claseColor">$@String.Format("{0:N2}", recaudado)</span></h5>
                <p class="text-secondary small mt-1">Basado en los turnos del período seleccionado.</p>
            </div>

            <!-- Botones -->
            <div class="d-flex justify-content-center gap-2 mt-4">
                <a asp-action="DetalleServicio" asp-route-servicio="@(Html.Raw(ViewBag.Servicio))"
                   class="btn btn-outline-light btn-rounded shadow-sm">
                    Volver
                </a>
                <a asp-action="Reportes" class="btn btn-primary btn-rounded shadow-sm">
                    Reportes
                </a>
            </div>

        </div>

    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        const datos = {
            labels: ["Realizados", "Cancelados"],
            datasets: [{
                label: "Turnos de @ViewBag.Peluquero",
                data: [@(ViewBag.Realizados ?? 0), @(ViewBag.Cancelados ?? 0)],
                backgroundColor: [
                    "rgba(54, 162, 235, 0.75)",
                    "rgba(255, 99, 132, 0.75)"
                ],
                borderColor: "white",
                borderWidth: 2,
                hoverOffset: 12
            }]
        };

        const ctx = document.getElementById('graficoTurnos').getContext('2d');

        new Chart(ctx, {
            type: "doughnut",
            data: datos,
            options: {
                plugins: {
                    legend: {
                        position: "bottom",
                        labels: { color: "white", padding: 20 }
                    },
                    title: {
                        display: true,
                        text: "Distribución de Turnos",
                        color: "white",
                        font: { size: 18, weight: "bold" },
                        padding: 20
                    }
                }
            }
        });
    </script>
}
