@{
    ViewData["Title"] = "Reportes - Servicios más elegidos";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="text-light fw-bold mb-1">📊 Reportes</h2>
        <p class="text-secondary mb-0">Servicios más seleccionados por clientes</p>
    </div>

    <a asp-controller="Administrador" asp-action="Dashboard"
       class="btn btn-outline-light shadow-sm">
        ⬅️ Volver al Inicio
    </a>
</div>

<div class="container mt-4">
    <div class="card bg-dark text-light shadow-lg rounded-4 border-secondary">

        <div class="card-header text-center py-3"
             style="background: linear-gradient(135deg, #0d6efd, #0a58ca);">
            <h4 class="fw-semibold mb-0">Servicios más elegidos</h4>
        </div>

        <div class="card-body text-center">
            <canvas id="graficoServicios" style="max-height:420px"></canvas>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        const servicios = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.Servicios ?? new List<string>()));
        const cantidades = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.Cantidades ?? new List<int>()));

        const ctx = document.getElementById('graficoServicios').getContext('2d');

        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: servicios,
                datasets: [{
                    label: 'Servicios más elegidos',
                    data: cantidades,
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.7)',
                        'rgba(255, 99, 132, 0.7)',
                        'rgba(255, 206, 86, 0.7)',
                        'rgba(75, 192, 192, 0.7)',
                        'rgba(153, 102, 255, 0.7)'
                    ],
                    borderColor: '#000',
                    borderWidth: 2
                }]
            },
            options: {
                onClick: (evt, elements) => {
                    if (elements.length > 0) {
                        const index = elements[0].index;
                        const servicio = servicios[index];

                        window.location.href =
                            `@Url.Action("DetalleServicio", "Administrador")?servicio=${encodeURIComponent(servicio)}`;
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: 'white'
                        }
                    }
                }
            }
        });
    </script>
}

<style>
    /* Hover suave para card */
    .card:hover {
        transform: translateY(-3px);
        transition: 0.25s ease;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.35) !important;
    }
</style>
