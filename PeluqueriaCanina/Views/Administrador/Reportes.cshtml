@{
    ViewData["Title"] = "Reportes - Servicios más elegidos";
}

<div class="overlay-dark p-4">
    <div class="container">

        <!-- Encabezado -->
        <div class="d-flex justify-content-between align-items-center flex-wrap mb-4">
            <div>
                <h2 class="text-light fw-bold mb-1">Reportes</h2>
                <p class="text-secondary mb-0">Servicios más seleccionados por clientes</p>
            </div>

            <div class="d-flex gap-2 mt-2 mt-md-0">
                <a asp-controller="Administrador" asp-action="Dashboard"
                   class="btn btn-outline-light btn-rounded shadow-sm">
                    Volver al Inicio
                </a>
            </div>
        </div>

        <!-- Card principal -->
        <div class="card card-custom text-light shadow-lg rounded-4 border-secondary">
            <!-- Header interno -->
            <div class="card-header card-header-custom text-center py-3">
                <h4 class="fw-semibold mb-0">Servicios Más Elegidos</h4>
            </div>

            <!-- Gráfico -->
            <div class="card-body text-center">
                <canvas id="graficoServicios" style="max-height:420px; width:100%;"></canvas>
                <p class="text-secondary small mt-3">Hacé clic en un servicio para ver sus detalles.</p>
            </div>
        </div>

    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        const servicios = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.Servicios ?? new List<string>()));
        const cantidades = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.Cantidades ?? new List<int>()));

        const ctx = document.getElementById('graficoServicios').getContext('2d');

        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: servicios,
                datasets: [{
                    label: 'Servicios más elegidos',
                    data: cantidades,
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.72)',
                        'rgba(255, 99, 132, 0.72)',
                        'rgba(255, 206, 86, 0.72)',
                        'rgba(75, 192, 192, 0.72)',
                        'rgba(153, 102, 255, 0.72)',
                        'rgba(255, 159, 64, 0.72)'
                    ],
                    borderColor: '#111',
                    borderWidth: 1.8
                }]
            },
            options: {
                onClick: (evt, elements) => {
                    if (elements.length > 0) {
                        const index = elements[0].index;
                        const servicio = servicios[index];
                        window.location.href =
                            `@Url.Action("DetalleServicio", "Administrador")?servicio=${encodeURIComponent(servicio)}`;
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: 'white',
                            padding: 18
                        }
                    }
                }
            }
        });
    </script>
}
