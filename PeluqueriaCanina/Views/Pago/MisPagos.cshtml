@model List<PeluqueriaCanina.Models.ClasesDePago.Pago>

@{
    ViewData["Title"] = "Mis Pagos";
}

<div class="container mt-4">
    <div class="glass-card">
        <div class="d-flex justify-content-between align-items-center mb-3 border-bottom pb-2">
            <h3 class="text-warning mb-0">💳 Mis Pagos</h3>

            <a href="/Turno/Index" class="btn btn-outline-light btn-sm rounded-pill px-3">
                <i class="bi bi-arrow-left"></i> Volver
            </a>
        </div>

        @if (Model == null || Model.Count == 0)
        {
            <div class="alert alert-dark text-center">
                <i class="bi bi-info-circle text-warning"></i>
                <span class="ms-2 text-light">Todavía no tenés pagos registrados.</span>
            </div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table table-dark table-hover align-middle rounded overflow-hidden">
                    <thead>
                        <tr class="bg-gradient-dark">
                            <th>N° Pago</th>
                            <th>Fecha</th>
                            <th>Servicio</th>
                            <th>Mascota</th>
                            <th>Método</th>
                            <th>Monto</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var pago in Model)
                        {
                            <tr>
                                <td class="fw-bold text-warning">
                                    #@pago.Id.ToString("D6")
                                </td>

                                <td>
                                    @pago.FechaPago.ToString("dd/MM/yyyy")<br>
                                    <small class="text-muted">@pago.FechaPago.ToString("HH:mm")</small>
                                </td>

                                <td>@pago.Turno.Servicio.NombreDelServicio</td>
                                <td>@pago.Turno.Mascota.Nombre</td>

                                <td>
                                    @switch (pago.MetodoPago.ToString())
                                    {
                                        case "Efectivo":
                                            <span>💵 Efectivo</span>
                                            ; break;
                                        case "TarjetaDebito":
                                            <span>💳 Débito</span>
                                            ; break;
                                        case "TarjetaCredito":
                                            <span>💳 Crédito</span>
                                            ; break;
                                        case "MercadoPago":
                                            <span>📱 MP</span>
                                            ; break;
                                        case "Transferencia":
                                            <span>🏦 Transf.</span>
                                            ; break;
                                    }
                                </td>

                                <td class="fw-bold text-success">
                                    $@pago.Monto.ToString("N2")
                                </td>

                                <td>
                                    @switch (pago.Estado.ToString())
                                    {
                                        case "Aprobado":
                                            <span class="badge bg-success px-3 py-2">Aprobado</span>
                                            ; break;
                                        case "Procesando":
                                            <span class="badge bg-warning text-dark px-3 py-2">Procesando</span>
                                            ; break;
                                        case "Pendiente":
                                            <span class="badge bg-info px-3 py-2">Pendiente</span>
                                            ; break;
                                        case "Rechazado":
                                            <span class="badge bg-danger px-3 py-2">Rechazado</span>
                                            ; break;
                                        case "Reembolsado":
                                            <span class="badge bg-secondary px-3 py-2">Reembolsado</span>
                                            ; break;
                                    }
                                </td>

                                <td>
                                    <a href="/Pago/Comprobante/@pago.Id"
                                       class="btn btn-sm btn-outline-warning rounded-pill px-3">
                                        <i class="bi bi-receipt"></i> Ver
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <!-- Resumen -->
            <div class="glass-card mt-4">
                <div class="row text-center">
                    <div class="col-md-3">
                        <h4 class="text-success">
                            @Model.Count(p => p.Estado == PeluqueriaCanina.Models.ClasesDePago.EstadoPago.Aprobado)
                        </h4>
                        <p class="text-muted mb-0">Aprobados</p>
                    </div>

                    <div class="col-md-3">
                        <h4 class="text-warning">
                            @Model.Count(p => p.Estado == PeluqueriaCanina.Models.ClasesDePago.EstadoPago.Procesando)
                        </h4>
                        <p class="text-muted mb-0">En Proceso</p>
                    </div>

                    <div class="col-md-3">
                        <h4 class="text-info">
                            @Model.Count(p => p.Estado == PeluqueriaCanina.Models.ClasesDePago.EstadoPago.Pendiente)
                        </h4>
                        <p class="text-muted mb-0">Pendientes</p>
                    </div>

                    <div class="col-md-3">
                        <h4 class="text-success">
                            $@(Model.Where(p => p.Estado == PeluqueriaCanina.Models.ClasesDePago.EstadoPago.Aprobado)
                            .Sum(p => p.Monto).ToString("N2"))
                        </h4>
                        <p class="text-muted mb-0">Total Pagado</p>
                    </div>
                </div>
            </div>
        }
    </div>
</div>
