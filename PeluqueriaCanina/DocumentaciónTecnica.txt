//VIEWS DE REPORTES DE SERVICIOS TOTALES
CREATE OR ALTER VIEW vw_ReporteServiciosTotales AS
SELECT
    s.Id,
    s.NombreDelServicio AS NombreServicio,
    COUNT(t.Id) AS Total
FROM Servicios s
LEFT JOIN Turnos t 
    ON t.ServicioId = s.Id 
    AND t.Estado = 4   -- Completado
GROUP BY s.Id, s.NombreDelServicio;





//VIEWS DE REPORTES DE PELUQUEROS POR SERVICIO
CREATE OR ALTER VIEW vw_ReportePeluquerosPorServicio AS
SELECT
    s.NombreDelServicio AS NombreServicio,
    CONCAT(p.Nombre, ' ', p.Apellido) AS NombrePeluquero,
    COUNT(t.Id) AS Cantidad
FROM Servicios s
CROSS JOIN Usuario p
LEFT JOIN Turnos t
    ON t.ServicioId = s.Id
    AND t.PeluqueroId = p.Id
    AND t.Estado = 4  -- Completado
WHERE p.Discriminator = 'Peluquero'
GROUP BY s.NombreDelServicio, p.Nombre, p.Apellido;





//VIEWS DE REPORTES DE DETALLES DE PELUQUEROS
CREATE OR ALTER VIEW vw_ReporteDetallePeluquero AS
SELECT
    s.NombreDelServicio AS NombreServicio,
    CONCAT(p.Nombre, ' ', p.Apellido) AS NombrePeluquero,
    SUM(CASE WHEN t.Estado = 4 THEN 1 ELSE 0 END) AS Realizados,   -- Completados
    SUM(CASE WHEN t.Estado = 3 THEN 1 ELSE 0 END) AS Cancelados,   -- Cancelados
    SUM(CASE WHEN t.Estado = 4 THEN t.Precio ELSE 0 END) AS Recaudado
FROM Servicios s
CROSS JOIN Usuario p
LEFT JOIN Turnos t
    ON t.ServicioId = s.Id
    AND t.PeluqueroId = p.Id
WHERE p.Discriminator = 'Peluquero'
GROUP BY s.NombreDelServicio, p.Nombre, p.Apellido;
